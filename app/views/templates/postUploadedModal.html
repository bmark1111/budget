<div class="modal-header">
	<h3 class="modal-title">{{ title }}</h3>
</div>
<div class="modal-body">
	<div class="row">
		<div class="col-md-4">
			<label>Account:</label> {{ transaction.bank_account.bank.name }} {{ transaction.bank_account.name }}
		</div>
		<div class="col-md-8">
			<label>Description:</label> {{ transaction.description }}
		</div>
	</div>
	<div class="row">
		<div class="col-md-3">
			<label>Date:</label> {{ transaction.transaction_date|date:'EEE MMM dd, yyyy' }}
		</div>
		<div class="col-md-2">
			<label>Type:</label> {{ transaction.type }}
		</div>
		<div class="col-md-2" ng-if="transaction.type == 'CHECK'">
			<label>Check Num:</label> {{ transaction.check_num }}
		</div>
		<div class="col-md-4">
			<label>Amount:</label> {{ transaction.amount|currency }}
			<div ng-class="{ 'has-error': validation.amount }">
				<span class="help-block" ng-show="validation.amount">{{ validation.amount }}</span>
			</div>
		</div>
		<div class="col-md-1 left">
			<button type="button" class="btn btn-primary" ng-model="singleModel" ng-click="is_split = !is_split">
				Split
			</button>
		</div>
	</div>
	<div class="row">
		<fieldset ng-disabled="isSaving">
			<div class="col-md-3" ng-if="!is_split">
				<label for="category">Category</label>
				<div class="form-group" ng-class="{'has-error':validation.category_id}">
					<select class="form-control" name="category" ng-model="transaction.category_id" ng-options="category.id as category.name for category in categories"></select>
					<span class="help-block" ng-show="validation.category_id">{{ validation.category_id }}</span>
				</div>
			</div>
			<div class="col-md-3" ng-if="!is_split && transaction.category_id == 17 && (transaction.type == 'CHECK' || transaction.type == 'DEBIT' || transaction.type == 'SALE')">
				<label for="transfer_account_id">To Account</label>
				<div class="form-group" ng-class="{ 'has-error': validation.transfer_account_id }">
					<select class="form-control" name="transfer_account_id" ng-disabled="!is_admin && transaction.reconciled_date" ng-model="transaction.transfer_account_id" ng-options="account.id as account.name for account in active_accounts"></select>
					<span class="help-block" ng-show="validation.transfer_account_id">{{ validation.transfer_account_id }}</span>
				</div>
			</div>
			<div class="col-md-3" ng-if="!is_split && transaction.category_id == 17 && (transaction.type == 'CREDIT' || transaction.type == 'DSLIP' || transaction.type == 'RETURN' || transaction.type == 'PAYMENT')">
				<label for="transfer_account_id">From Account</label>
				<div class="form-group" ng-class="{ 'has-error': validation.transfer_account_id }">
					<select class="form-control" name="transfer_account_id" ng-disabled="!is_admin && transaction.reconciled_date" ng-model="transaction.transfer_account_id" ng-options="account.id as account.name for account in active_accounts"></select>
					<span class="help-block" ng-show="validation.transfer_account_id">{{ validation.transfer_account_id }}</span>
				</div>
			</div>
			<div class="col-md-4" ng-if="!is_split && transaction.category_id != 17">
				<div class="form-group" ng-class="{ 'has-error': validation.vendor_id }">
					<div id="liveSearch">
						<label for="name">Payee/Payer</label>{{ display_name }}
						<div live-search="vendor_id" display_name="{{ display_name }}"></div>
					</div>
					<span class="help-block" ng-show="validation.vendor_id">{{ validation.vendor_id }}</span>
				</div>
			</div>
			<div class="col-md-5">
				<div class="form-group">
					<label for="notes">Notes</label>
					<input type="text" name="notes" class="form-control" ng-model="transaction.notes" />
				</div>
			</div>
		</fieldset>
	</div>
	<div split-tran is-split="{{ is_split }}"></div>
	<div class="table-responsive" ng-if="repeats[0]">
		<div class="row">
			<div class="col-sm-12">
				<h3>Multiple Possible Repeat Transactions</h3>
				<span>Select possible repeat transaction</span>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12">
				<table style="width:100%;">
					<thead>
						<tr>
							<th class="col-sm-3"><span class="pull-left">Next Due Date</span></th>
							<th class="col-sm-2"><span class="pull-left">Account</span></th>
							<th class="col-sm-1"><span class="pull-left">Type</span></th>
							<th class="col-sm-1"><span class="pull-left">Category</span></th>
							<th class="col-sm-4"><span class="pull-left">Vendor</span></th>
							<th class="col-sm-1"><span class="pull-left">Amount</span></th>
						</tr>
					</thead>
					<tbody ng-repeat="idx in repeats_seq">
						<tr ng-click="setRepeat(repeats[idx])" ng-class="{selected: repeats[idx].id === idSelectedTransaction}">
							<td>
								<span class="pull-left">{{ repeats[idx].next_due_date|date:'EEE MMM dd, yyyy' }}</span>
							</td>
							<td>
								<span class="pull-left">{{ repeats[idx].bank_account.bank.name }} {{ repeats[idx].bank_account.name }}</span>
							</td>
							<td>
								<span class="pull-left">{{ repeats[idx].type }}</span>
							</td>
							<td ng-if="repeats[idx].category_id">
								<span class="pull-left">{{ repeats[idx].category.name }}</span>
							</td>
							<td ng-if='repeats[idx].vendor_id'>
								<span class="pull-left">{{ repeats[idx].vendor.name }}</span><br />
								<span ng-if="repeats[idx].description"><em>{{ repeats[idx].description }}</em><br /></span>
								<span ng-if="repeats[idx].notes"><em>{{ repeats[idx].notes }}</em></span>
							</td>
							<td colspan="2" style="text-align:center;" ng-if="!repeats[idx].category_id && !repeats[idx].vendor_id">
								<span>--Split--</span>
							</td>
							<td>
								<span class="pull-right">{{ repeats[idx].amount|currency }}</span>
							</td>
						</tr>
						<tr ng-repeat="split in repeats[idx].splits" style="font-size: 12px;" ng-class="{selected: repeats[idx].id === idSelectedTransaction}">
							<td colspan="3"></td>
							<td>
								<span class="pull-left">{{ split.category.name }}</span>
							</td>
							<td>
								<span class="pull-left">{{ split.vendor.name }}</span><br />
								<span ng-if="split.description"><em>{{ split.description }}</em><br /></span>
								<span ng-if="split.notes"><em>{{ split.notes }}</em></span>
							</td>
							<td>
								<span class="pull-right">{{ split.amount|currency }}</span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="table-responsive" ng-if="transactions[0]">
		<div class="row">
			<div class="col-sm-12">
				<h3>Possible Duplicate Transactions</h3>
				<span>Select possible duplicate transaction to overwrite</span>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12">
				<table style="width:100%;">
					<thead>
						<tr>
							<th class="col-sm-3"><span class="pull-left">Date</span></th>
							<th class="col-sm-2"><span class="pull-left">Account</span></th>
							<th class="col-sm-1"><span class="pull-left">Type</span></th>
							<th class="col-sm-1"><span class="pull-left">Category</span></th>
							<th class="col-sm-4"><span class="pull-left">Vendor</span></th>
							<th class="col-sm-1"><span class="pull-left">Amount</span></th>
						</tr>
					</thead>
					<tbody ng-repeat="idx in transactions_seq">
						<tr ng-click="setSelected(transactions[idx])" ng-class="{selected: transactions[idx].id === idSelectedTransaction}">
							<td>
								<span class="pull-left">{{ transactions[idx].transaction_date|date:'EEE MMM dd, yyyy' }}</span> &nbsp;
								<span ng-if="transactions[idx].is_uploaded == 1" class="glyphicon glyphicon-upload" title="Uploaded"></span>
								<img ng-if="transactions[idx].reconciled_date" ng-src="app/images/transparent-green-checkmark-th.png" height="12" width="8" title="Reconciled" /> 
							</td>
							<td>
								<span class="pull-left">{{ transactions[idx].bank_account.bank.name }} {{ transactions[idx].bank_account.name }}</span>
							</td>
							<td>
								<span class="pull-left">{{ transactions[idx].type }}</span>
							</td>
							<td ng-if="transactions[idx].category_id">
								<span class="pull-left">{{ transactions[idx].category.name }}</span>
							</td>
							<td ng-if='transactions[idx].vendor_id'>
								<span class="pull-left">{{ transactions[idx].vendor.name }}</span><br />
								<span ng-if="transactions[idx].description"><em>{{ transactions[idx].description }}</em><br /></span>
								<span ng-if="transactions[idx].notes"><em>{{ transactions[idx].notes }}</em></span>
							</td>
							<td colspan="2" style="text-align:center;" ng-if="!transactions[idx].category_id && !transactions[idx].vendor_id">
								<span>--Split--</span>
							</td>
							<td>
								<span class="pull-right">{{ transactions[idx].amount|currency }}</span>
							</td>
						</tr>
						<tr ng-repeat="split in transactions[idx].splits" style="font-size: 12px;" ng-class="{selected: transactions[idx].id === idSelectedTransaction}">
							<td colspan="3"></td>
							<td>
								<span class="pull-left">{{ split.category.name }}</span>
							</td>
							<td>
								<span class="pull-left">{{ split.vendor.name }}</span><br />
								<span ng-if="split.description"><em>{{ split.description }}</em><br /></span>
								<span ng-if="split.notes"><em>{{ split.notes }}</em></span>
							</td>
							<td>
								<span class="pull-right">{{ split.amount|currency }}</span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div class="row" ng-if="dataErrorMsg[0]">
			<div class="col-sm-12">
				<p class="text-muted" style="color:red;" ng-repeat="error in dataErrorMsg">{{error}}</p>
			</div>
		</div>
	</div>
</div>
<div class="modal-footer">
	<button class="btn btn-primary" ng-click="deleteUploaded()" ng-disabled="isSaving">Discard</button>
	<button class="btn btn-primary" ng-click="postUploaded()" ng-disabled="isSaving">{{ post }}</button>
	<button class="btn btn-warning" ng-click="cancel()">Cancel</button>
</div>
